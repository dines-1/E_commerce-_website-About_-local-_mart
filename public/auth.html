<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Mart - Login & Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <style>
    .slider { transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1); }
    @keyframes slideUp {
      from { transform: translate(-50%, 100px); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }
  </style>
</head>
<body class="bg-gray-100">

<div id="app" class="min-h-screen flex items-center justify-center px-4 py-12">
  <div class="max-w-6xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col lg:flex-row">

    <div class="hidden lg:block w-full lg:w-1/2 bg-cover bg-center relative"
         style="background-image: url('assets/auth-bg.jpg');">
      <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-black/30"></div>
      <div class="absolute bottom-10 left-10 text-white">
        <h1 class="text-5xl font-bold">Local Mart</h1>
        <p class="text-2xl font-light mt-2">Fresh. Local. Delivered.</p>
      </div>
    </div>

    <div class="w-full lg:w-1/2 p-10 lg:p-16 bg-gray-50 flex items-center justify-center">
      <div class="w-full max-w-md">
        <div class="relative overflow-hidden" style="min-height: 680px;">
          <div :style="{ transform: isLogin ? 'translateX(0)' : 'translateX(-100%)' }" class="slider flex">

            <div class="w-full flex-shrink-0 space-y-8">
              <div class="text-center">
                <h1 class="text-4xl font-bold text-green-600">Welcome Back!</h1>
                <p class="text-gray-600 mt-3 text-lg">Log in to your account</p>
              </div>

              <form @submit.prevent="login" class="space-y-6">
                <div>
                  <input v-model="login.email" type="email" required placeholder="Email Address"
                         class="w-full px-5 py-4 text-lg border-2 rounded-xl transition"
                         :class="errors.loginEmail ? 'border-red-500' : 'border-gray-300 focus:border-green-500'"
                         @input="validateLoginField('email')">
                  <p v-if="errors.loginEmail" class="text-red-600 text-sm mt-1">{{ errors.loginEmail }}</p>
                </div>

                <div>
                  <input v-model="login.password" type="password" required minlength="6" placeholder="Password"
                         class="w-full px-5 py-4 text-lg border-2 rounded-xl transition"
                         :class="errors.loginPass ? 'border-red-500' : 'border-gray-300 focus:border-green-500'"
                         @input="validateLoginField('password')">
                  <p v-if="errors.loginPass" class="text-red-600 text-sm mt-1">{{ errors.loginPass }}</p>
                </div>

                <button type="submit" :disabled="loading"
                        class="w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-bold text-xl py-5 rounded-xl shadow-lg transition">
                  <i v-if="loading" class="fas fa-spinner fa-spin mr-2"></i>
                  {{ loading ? 'Logging in...' : 'Login to Account' }}
                </button>

                <p class="text-center text-lg text-gray-600 mt-10">
                  New here? 
                  <button @click="isLogin = false" type="button" class="text-green-600 font-bold hover:underline">Create account</button>
                </p>
              </form>
            </div>

            <div class="w-full flex-shrink-0 space-y-6">
              <div class="text-center">
                <h1 class="text-4xl font-bold text-green-600">Create Account</h1>
                <p class="text-gray-600 mt-3 text-lg">Create Sasto Bazaar account and enjoy </p>
              </div>

              <form @submit.prevent="register" class="space-y-5">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <input v-model="signup.firstname" type="text" required placeholder="First Name"
                           class="w-full px-5 py-4 text-lg border-2 rounded-xl"
                           :class="errors.firstname ? 'border-red-500' : 'border-gray-300 focus:border-green-500'"
                           @input="validateSignupField">
                    <p v-if="errors.firstname" class="text-red-600 text-sm mt-1">{{ errors.firstname }}</p>
                  </div>
                  <div>
                    <input v-model="signup.lastname" type="text" required placeholder="Last Name"
                           class="w-full px-5 py-4 text-lg border-2 rounded-xl"
                           :class="errors.lastname ? 'border-red-500' : 'border-gray-300 focus:border-green-500'"
                           @input="validateSignupField">
                    <p v-if="errors.lastname" class="text-red-600 text-sm mt-1">{{ errors.lastname }}</p>
                  </div>
                </div>

                <div>
                  <input v-model="signup.email" type="email" required placeholder="Email Address"
                         class="w-full px-5 py-4 text-lg border-2 rounded-xl"
                         :class="errors.email ? 'border-red-500' : 'border-gray-300 focus:border-green-500'"
                         @input="validateSignupField">
                  <p v-if="errors.email" class="text-red-600 text-sm mt-1">{{ errors.email }}</p>
                </div>

                <div>
                  <input v-model="signup.phone" type="tel" placeholder="Phone (optional)"
                         class="w-full px-5 py-4 text-lg border-2 rounded-xl border-gray-300 focus:border-green-500"
                         @input="validateSignupField">
                  <p v-if="errors.phone" class="text-red-600 text-sm mt-1">{{ errors.phone }}</p>
                </div>

                <div>
                  <input v-model="signup.password" type="password" required minlength="6" placeholder="Create Password"
                         class="w-full px-5 py-4 text-lg border-2 rounded-xl"
                         :class="errors.password ? 'border-red-500' : 'border-gray-300 focus:border-green-500'"
                         @input="validateSignupField">
                  <p v-if="errors.password" class="text-red-600 text-sm mt-1">{{ errors.password }}</p>
                </div>

                <button type="submit" :disabled="loading"
                        class="w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-bold text-xl py-5 rounded-xl shadow-lg transition">
                  <i v-if="loading" class="fas fa-spinner fa-spin mr-2"></i>
                  {{ loading ? 'Creating Account...' : 'Create Free Account' }}
                </button>

                <p class="text-center text-lg text-gray-600 mt-10">
                  Already have an account? 
                  <button @click="isLogin = true" type="button" class="text-green-600 font-bold hover:underline">Login here</button>
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div v-if="toast.show" 
       class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 px-8 py-4 rounded-xl shadow-2xl text-white font-semibold text-lg flex items-center gap-3"
       :class="toast.type === 'success' ? 'bg-green-600' : 'bg-red-600'"
       style="animation: slideUp 0.5s ease-out;">
    <i :class="toast.type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
    {{ toast.message }}
  </div>
</div>

<script>
const { createApp, ref, reactive } = Vue;
createApp({
  setup() {
    const isLogin = ref(true);
    const loading = ref(false);

    const log = reactive({ email: '', password: '' });
    const signup = reactive({ firstname: '', lastname: '', email: '', phone: '', password: '' });

    const errors = reactive({
      loginEmail: '', loginPass: '',
      firstname: '', lastname: '', email: '', phone: '', password: ''
    });

    const toast = reactive({ show: false, message: '', type: 'success' });
    const showToast = (msg, type = 'success') => {
      toast.message = msg; toast.type = type; toast.show = true;
      setTimeout(() => toast.show = false, 4500);
    };

    const clearErrors = () => Object.keys(errors).forEach(k => errors[k] = '');

    const isValidName = name => /^[A-Za-z\s]{3,30}$/.test(name.trim());
    const isValidEmail = email => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    const isValidPhone = phone => !phone || /^[6-9]\d{9}$/.test(phone);
    const isValidPassword = pass => pass.length >= 8;

    const validateLoginField = (field) => {
      if (field === 'email') errors.loginEmail = login.email && !isValidEmail(login.email) ? 'Invalid email' : '';
      if (field === 'password') errors.loginPass = login.password && !isValidPassword(login.password) ? 'Min 6 characters' : '';
    };

    const validateSignupField = () => {
      errors.email = signup.email && !isValidEmail(signup.email) ? 'Invalid email' : '';
      errors.phone = signup.phone && !isValidPhone(signup.phone) ? 'Invalid phone (10 digits)' : '';
      errors.password = signup.password && !isValidPassword(signup.password) ? 'Min 8 characters' : '';
    };

    const login = async () => {
      clearErrors();
      if (!isValidEmail(login.email)) errors.loginEmail = 'Enter valid email';
      if (!isValidPassword(login.password)) errors.loginPass = 'Password too short';
      if (errors.loginEmail || errors.loginPass) return;

      loading.value = true;
      try {
        const res = await axios.post('api/login.php', login);
        if (res.data.success) {
          showToast('Login successful!', 'success');
          setTimeout(() => window.location = res.data.role === 'admin' ? '../admin/dashboard.php' : 'index.php', 1500);
        } else {
          showToast(res.data.message || 'Invalid credentials', 'error');
        }
      } catch (err) {
        showToast(err.response?.data?.message || 'Login failed', 'error');
      } finally {
        loading.value = false;
      }
    };

  const register = async () => {
  clearErrors();
  validateSignupField();
  if (Object.values(errors).some(e => e)) {
    showToast('Please fix the errors', 'error');
    return;
  }

  loading.value = true;
  try {
    const res = await axios.post('api/register.php', { 
      ...signup, 
      role: 'customer' 
    });
    
    if (res.data.success) {
      showToast('Account created! Please login', 'success');
      isLogin.value = true;
      Object.assign(signup, { 
        firstname: '', 
        lastname: '', 
        email: '', 
        phone: '', 
        password: '' 
      });
    } else {
      showToast(res.data.message || 'Registration failed', 'error');
    }
  } catch (err) {
    showToast(err.response?.data?.message || 'Registration failed. Please try again.', 'error');
  } finally {
    loading.value = false;
  }
};

    return {
      isLogin, loading, login, signup, errors, toast,
      login, register, validateLoginField, validateSignupField
    };
  }
}).mount('#app');
</script>

</body>
</html>